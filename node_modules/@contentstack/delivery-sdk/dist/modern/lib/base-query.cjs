"use strict";
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/lib/base-query.ts
var base_query_exports = {};
__export(base_query_exports, {
  BaseQuery: () => BaseQuery
});
module.exports = __toCommonJS(base_query_exports);
var import_core = require("@contentstack/core");
var import_pagination = require("./pagination.cjs");
var import_utils = require("./utils.cjs");
var BaseQuery = class extends import_pagination.Pagination {
  constructor() {
    super(...arguments);
    this._parameters = {};
  }
  /**
   * Helper method to cast this instance to Query type
   * @private
   */
  asQuery() {
    return this;
  }
  /**
   * @method includeCount
   * @memberof BaseQuery
   * @description Retrieve count and data of objects in result
   * @example
   * import contentstack from '@contentstack/delivery-sdk'
   *
   * const stack = contentstack.stack({ apiKey: "apiKey", deliveryToken: "deliveryToken", environment: "environment" });
   * const query = stack.contentType("contentTypeUid").entry().query();
   * const result = await query.includeCount().find()
   * // OR
   * const asset = await stack.asset().includeCount().find()
   *
   * @returns {Query}
   */
  includeCount() {
    this._queryParams.include_count = "true";
    return this.asQuery();
  }
  /**
   * @method orderByAscending
   * @memberof BaseQuery
   * @description Sorts the results in ascending order based on the specified field UID.
   * @example
   * import contentstack from '@contentstack/delivery-sdk'
   *
   * const stack = contentstack.stack({ apiKey: "apiKey", deliveryToken: "deliveryToken", environment: "environment" });
   * const query = stack.contentType("contentTypeUid").entry().query();
   * const result = await query.orderByAscending("field_uid").find()
   * // OR
   * const asset = await stack.asset().orderByAscending("field_uid").find()
   *
   * @returns {Query}
   */
  orderByAscending(key) {
    this._queryParams.asc = key;
    return this.asQuery();
  }
  /**
   * @method orderByDescending
   * @memberof BaseQuery
   * @description Sorts the results in descending order based on the specified key.
   * @example
   * import contentstack from '@contentstack/delivery-sdk'
   *
   * const stack = contentstack.stack({ apiKey: "apiKey", deliveryToken: "deliveryToken", environment: "environment" });
   * const query = stack.contentType("contentTypeUid").entry().query();
   * const result = await query.orderByDescending("field_uid").find()
   * // OR
   * const asset = await stack.asset().orderByDescending("field_uid").find()
   *
   * @returns {Query}
   */
  orderByDescending(key) {
    this._queryParams.desc = key;
    return this.asQuery();
  }
  /**
   * @method limit
   * @memberof BaseQuery
   * @description Returns a specific number of entries based on the set limit
   * @example
   * import contentstack from '@contentstack/delivery-sdk'
   *
   * const stack = contentstack.stack({ apiKey: "apiKey", deliveryToken: "deliveryToken", environment: "environment" });
   * const query = stack.contentType("contentTypeUid").entry().query();
   * const result = await query.limit(10).find()
   * // OR
   * const asset = await stack.asset().limit(5).find()
   *
   * @returns {Query}
   */
  limit(key) {
    this._queryParams.limit = key;
    return this.asQuery();
  }
  /**
   * @method skip
   * @memberof BaseQuery
   * @description Skips at specific number of entries.
   * @example
   * import contentstack from '@contentstack/delivery-sdk'
   *
   * const stack = contentstack.stack({ apiKey: "apiKey", deliveryToken: "deliveryToken", environment: "environment" });
   * const query = stack.contentType("contentTypeUid").entry().query();
   * const result = await query.skip(10).find()
   * // OR
   * const asset = await stack.asset().skip(5).find()
   *
   * @returns {Query}
   */
  skip(key) {
    this._queryParams.skip = key;
    return this.asQuery();
  }
  /**
   * @method param
   * @memberof BaseQuery
   * @description Adds query parameters to the URL.
   * @example
   * import contentstack from '@contentstack/delivery-sdk'
   *
   * const stack = contentstack.stack({ apiKey: "apiKey", deliveryToken: "deliveryToken", environment: "environment" });
   * const query = stack.contentType("contentTypeUid").entry().query();
   * const result = await query.param("key", "value").find()
   * // OR
   * const asset = await stack.asset().param("key", "value").find()
   *
   * @returns {Query}
   */
  param(key, value) {
    this._queryParams[key] = value;
    return this.asQuery();
  }
  /**
   * @method addParams
   * @memberof BaseQuery
   * @description Adds a query parameter to the query.
   * @example
   * import contentstack from '@contentstack/delivery-sdk'
   *
   * const stack = contentstack.stack({ apiKey: "apiKey", deliveryToken: "deliveryToken", environment: "environment" });
   * const query = stack.contentType("contentTypeUid").entry().query();
   * const result = await query.addParams({"key": "value"}).find()
   * // OR
   * const asset = await stack.asset().addParams({"key": "value"}).find()
   *
   * @returns {Query}
   */
  addParams(paramObj) {
    this._queryParams = { ...this._queryParams, ...paramObj };
    return this.asQuery();
  }
  /**
   * @method removeParam
   * @memberof BaseQuery
   * @description Removes a query parameter from the query.
   * @example
   * import contentstack from '@contentstack/delivery-sdk'
   *
   * const stack = contentstack.stack({ apiKey: "apiKey", deliveryToken: "deliveryToken", environment: "environment" });
   * const query = stack.contentType("contentTypeUid").entry().query();
   * const result = await query.removeParam("query_param_key").find()
   * // OR
   * const asset = await stack.asset().removeParam("query_param_key").find()
   *
   * @returns {Query}
   */
  removeParam(key) {
    delete this._queryParams[key];
    return this.asQuery();
  }
  /**
   * @method find
   * @memberof BaseQuery
   * @description Fetches the data based on the query parameters
   * @param {boolean} encode - Whether to encode query parameters
   * @returns {Promise<FindResponse<T>>} Promise that resolves to the find response
   * @example
   * import contentstack from '@contentstack/delivery-sdk'
   *
   * const stack = contentstack.stack({ apiKey: "apiKey", deliveryToken: "deliveryToken", environment: "environment" });
   * const result = await stack.asset().find();
   * @example
   * import contentstack from '@contentstack/delivery-sdk'
   *
   * const stack = contentstack.stack({ apiKey: "apiKey", deliveryToken: "deliveryToken", environment: "environment" });
   * const result = await stack.contentType("contentType1Uid").entry().query().find();
   * @example
   * import contentstack from '@contentstack/delivery-sdk'
   *
   * const stack = contentstack.stack({ apiKey: "apiKey", deliveryToken: "deliveryToken", environment: "environment" });
   * const result = await stack.contentType("contentTypeUid").entry().query().find();
   */
  async find(encode = false) {
    let requestParams = this._queryParams;
    if (Object.keys(this._parameters).length > 0) {
      let queryParams = { ...this._parameters };
      if (encode) {
        queryParams = (0, import_utils.encodeQueryParams)(queryParams);
      }
      requestParams = { ...this._queryParams, query: queryParams };
    }
    const getRequestOptions = {
      params: requestParams,
      // Add contentTypeUid to config for improved caching (extract from URL if possible)
      contentTypeUid: this.extractContentTypeUidFromUrl()
    };
    if (this._variants) {
      getRequestOptions.headers = {
        ...getRequestOptions.headers,
        "x-cs-variant-uid": this._variants
      };
    }
    const response = await (0, import_core.getData)(this._client, this._urlPath, getRequestOptions);
    return response;
  }
  /**
   * Extracts content type UID from the URL path
   * @returns content type UID if found, null otherwise
   */
  extractContentTypeUidFromUrl() {
    if (!this._urlPath) return null;
    const contentTypePattern = /\/content_types\/([^\/]+)/;
    const match = this._urlPath.match(contentTypePattern);
    return match ? match[1] : null;
  }
};
// Annotate the CommonJS export names for ESM import in node:
0 && (module.exports = {
  BaseQuery
});
//# sourceMappingURL=base-query.cjs.map