{"version":3,"sources":["../../../src/lib/base-query.ts"],"sourcesContent":["import { AxiosInstance, getData } from '@contentstack/core';\nimport { Pagination } from './pagination';\nimport { FindResponse, params } from './types';\nimport { encodeQueryParams } from './utils';\nimport type { Query } from './query';\n\nexport class BaseQuery extends Pagination {\n  _parameters: params = {}; // Params of query class ?query={}\n\n  protected _client!: AxiosInstance;\n  protected _urlPath!: string;\n  protected _variants!: string;\n\n  /**\n   * Helper method to cast this instance to Query type\n   * @private\n   */\n  protected asQuery(): Query {\n    return this as unknown as Query;\n  }\n\n  /**\n   * @method includeCount\n   * @memberof BaseQuery\n   * @description Retrieve count and data of objects in result\n   * @example\n   * import contentstack from '@contentstack/delivery-sdk'\n   *\n   * const stack = contentstack.stack({ apiKey: \"apiKey\", deliveryToken: \"deliveryToken\", environment: \"environment\" });\n   * const query = stack.contentType(\"contentTypeUid\").entry().query();\n   * const result = await query.includeCount().find()\n   * // OR\n   * const asset = await stack.asset().includeCount().find()\n   *\n   * @returns {Query}\n   */\n  includeCount(): Query {\n    this._queryParams.include_count = 'true';\n\n    return this.asQuery();\n  }\n\n  /**\n   * @method orderByAscending\n   * @memberof BaseQuery\n   * @description Sorts the results in ascending order based on the specified field UID.\n   * @example\n   * import contentstack from '@contentstack/delivery-sdk'\n   *\n   * const stack = contentstack.stack({ apiKey: \"apiKey\", deliveryToken: \"deliveryToken\", environment: \"environment\" });\n   * const query = stack.contentType(\"contentTypeUid\").entry().query();\n   * const result = await query.orderByAscending(\"field_uid\").find()\n   * // OR\n   * const asset = await stack.asset().orderByAscending(\"field_uid\").find()\n   *\n   * @returns {Query}\n   */\n  orderByAscending(key: string): Query {\n    this._queryParams.asc = key;\n\n    return this.asQuery();\n  }\n\n  /**\n   * @method orderByDescending\n   * @memberof BaseQuery\n   * @description Sorts the results in descending order based on the specified key.\n   * @example\n   * import contentstack from '@contentstack/delivery-sdk'\n   *\n   * const stack = contentstack.stack({ apiKey: \"apiKey\", deliveryToken: \"deliveryToken\", environment: \"environment\" });\n   * const query = stack.contentType(\"contentTypeUid\").entry().query();\n   * const result = await query.orderByDescending(\"field_uid\").find()\n   * // OR\n   * const asset = await stack.asset().orderByDescending(\"field_uid\").find()\n   *\n   * @returns {Query}\n   */\n  orderByDescending(key: string): Query {\n    this._queryParams.desc = key;\n\n    return this.asQuery();\n  }\n\n  /**\n   * @method limit\n   * @memberof BaseQuery\n   * @description Returns a specific number of entries based on the set limit\n   * @example\n   * import contentstack from '@contentstack/delivery-sdk'\n   *\n   * const stack = contentstack.stack({ apiKey: \"apiKey\", deliveryToken: \"deliveryToken\", environment: \"environment\" });\n   * const query = stack.contentType(\"contentTypeUid\").entry().query();\n   * const result = await query.limit(10).find()\n   * // OR\n   * const asset = await stack.asset().limit(5).find()\n   *\n   * @returns {Query}\n   */\n  limit(key: number): Query {\n    this._queryParams.limit = key;\n\n    return this.asQuery();\n  }\n\n  /**\n   * @method skip\n   * @memberof BaseQuery\n   * @description Skips at specific number of entries.\n   * @example\n   * import contentstack from '@contentstack/delivery-sdk'\n   *\n   * const stack = contentstack.stack({ apiKey: \"apiKey\", deliveryToken: \"deliveryToken\", environment: \"environment\" });\n   * const query = stack.contentType(\"contentTypeUid\").entry().query();\n   * const result = await query.skip(10).find()\n   * // OR\n   * const asset = await stack.asset().skip(5).find()\n   *\n   * @returns {Query}\n   */\n  skip(key: number): Query {\n    this._queryParams.skip = key;\n\n    return this.asQuery();\n  }\n\n\n\n  /**\n   * @method param\n   * @memberof BaseQuery\n   * @description Adds query parameters to the URL.\n   * @example\n   * import contentstack from '@contentstack/delivery-sdk'\n   *\n   * const stack = contentstack.stack({ apiKey: \"apiKey\", deliveryToken: \"deliveryToken\", environment: \"environment\" });\n   * const query = stack.contentType(\"contentTypeUid\").entry().query();\n   * const result = await query.param(\"key\", \"value\").find()\n   * // OR\n   * const asset = await stack.asset().param(\"key\", \"value\").find()\n   *\n   * @returns {Query}\n   */\n  param(key: string, value: string | number): Query {\n    this._queryParams[key] = value;\n\n    return this.asQuery();\n  }\n\n  /**\n   * @method addParams\n   * @memberof BaseQuery\n   * @description Adds a query parameter to the query.\n   * @example\n   * import contentstack from '@contentstack/delivery-sdk'\n   *\n   * const stack = contentstack.stack({ apiKey: \"apiKey\", deliveryToken: \"deliveryToken\", environment: \"environment\" });\n   * const query = stack.contentType(\"contentTypeUid\").entry().query();\n   * const result = await query.addParams({\"key\": \"value\"}).find()\n   * // OR\n   * const asset = await stack.asset().addParams({\"key\": \"value\"}).find()\n   *\n   * @returns {Query}\n   */\n  addParams(paramObj: { [key: string]: string | boolean | number }): Query {\n    this._queryParams = { ...this._queryParams, ...paramObj };\n\n    return this.asQuery();\n  }\n\n  /**\n   * @method removeParam\n   * @memberof BaseQuery\n   * @description Removes a query parameter from the query.\n   * @example\n   * import contentstack from '@contentstack/delivery-sdk'\n   *\n   * const stack = contentstack.stack({ apiKey: \"apiKey\", deliveryToken: \"deliveryToken\", environment: \"environment\" });\n   * const query = stack.contentType(\"contentTypeUid\").entry().query();\n   * const result = await query.removeParam(\"query_param_key\").find()\n   * // OR\n   * const asset = await stack.asset().removeParam(\"query_param_key\").find()\n   *\n   * @returns {Query}\n   */\n  removeParam(key: string): Query {\n    delete this._queryParams[key];\n\n    return this.asQuery();\n  }\n\n  /**\n   * @method find\n   * @memberof BaseQuery\n   * @description Fetches the data based on the query parameters\n   * @param {boolean} encode - Whether to encode query parameters\n   * @returns {Promise<FindResponse<T>>} Promise that resolves to the find response\n   * @example\n   * import contentstack from '@contentstack/delivery-sdk'\n   *\n   * const stack = contentstack.stack({ apiKey: \"apiKey\", deliveryToken: \"deliveryToken\", environment: \"environment\" });\n   * const result = await stack.asset().find();\n   * @example\n   * import contentstack from '@contentstack/delivery-sdk'\n   *\n   * const stack = contentstack.stack({ apiKey: \"apiKey\", deliveryToken: \"deliveryToken\", environment: \"environment\" });\n   * const result = await stack.contentType(\"contentType1Uid\").entry().query().find();\n   * @example\n   * import contentstack from '@contentstack/delivery-sdk'\n   *\n   * const stack = contentstack.stack({ apiKey: \"apiKey\", deliveryToken: \"deliveryToken\", environment: \"environment\" });\n   * const result = await stack.contentType(\"contentTypeUid\").entry().query().find();\n   */\n\n  async find<T>(encode: boolean = false): Promise<FindResponse<T>> {\n    let requestParams: { [key: string]: any } = this._queryParams;\n\n    if (Object.keys(this._parameters).length > 0) {\n      let queryParams = { ...this._parameters };\n      \n      if (encode) {\n        queryParams = encodeQueryParams(queryParams);\n      }\n      \n      requestParams = { ...this._queryParams, query: queryParams };\n    }\n\n    const getRequestOptions: any = { \n      params: requestParams,\n      // Add contentTypeUid to config for improved caching (extract from URL if possible)\n      contentTypeUid: this.extractContentTypeUidFromUrl()\n    };\n\n    if (this._variants) {\n      getRequestOptions.headers = {\n        ...getRequestOptions.headers,\n        'x-cs-variant-uid': this._variants\n      };\n    }\n    const response = await getData(this._client, this._urlPath, getRequestOptions);\n\n    return response as FindResponse<T>;\n  }\n\n  /**\n   * Extracts content type UID from the URL path\n   * @returns content type UID if found, null otherwise\n   */\n  private extractContentTypeUidFromUrl(): string | null {\n    if (!this._urlPath) return null;\n    \n    // Match patterns like: /content_types/{content_type_uid}/entries\n    const contentTypePattern = /\\/content_types\\/([^\\/]+)/;\n    const match = this._urlPath.match(contentTypePattern);\n    \n    return match ? match[1] : null;\n  }\n}\n"],"mappings":"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","names":[]}