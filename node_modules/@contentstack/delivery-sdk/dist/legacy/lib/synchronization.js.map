{"version":3,"sources":["../../../src/lib/synchronization.ts"],"sourcesContent":["import { AxiosInstance, getData } from '@contentstack/core';\nimport { SyncStack, SyncType, PublishType } from './types';\nimport { AxiosRequestConfig, AxiosResponse } from 'axios';\nimport humps from 'humps';\n\nexport async function synchronization(client: AxiosInstance, params: SyncStack | SyncType = {}, recursive = false) {\n  const config: AxiosRequestConfig = { params };\n  const SYNC_URL = '/stacks/sync';\n\n  if (!('paginationToken' in params || 'syncToken' in params)) {\n    // for every config except sync and pagination token\n    config.params = { ...params, init: true };\n  }\n\n  if ((params as SyncType).type && typeof (params as SyncType).type !== 'string') {\n    const type = (params as SyncType).type as PublishType[];\n    config.params = { ...config.params, type: type.join(',') };\n  }\n\n  let response: AxiosResponse = await getData(client, SYNC_URL, { params: humps.decamelizeKeys(config.params) });\n  const data = response.data;\n\n  while (recursive && 'pagination_token' in response.data) {\n    const recResponse: AxiosResponse = await getData(\n      client,\n      SYNC_URL,\n      humps.decamelizeKeys({ paginationToken: data.pagination_token })\n    );\n    recResponse.data.items = { ...response.data.items, ...recResponse.data.items };\n    response = { ...recResponse };\n  }\n\n  return response.data;\n}\n"],"mappings":";AAAA,SAAwB,eAAe;AAGvC,OAAO,WAAW;AAElB,eAAsB,gBAAgB,QAAuB,SAA+B,CAAC,GAAG,YAAY,OAAO;AACjH,QAAM,SAA6B,EAAE,OAAO;AAC5C,QAAM,WAAW;AAEjB,MAAI,EAAE,qBAAqB,UAAU,eAAe,SAAS;AAE3D,WAAO,SAAS,EAAE,GAAG,QAAQ,MAAM,KAAK;AAAA,EAC1C;AAEA,MAAK,OAAoB,QAAQ,OAAQ,OAAoB,SAAS,UAAU;AAC9E,UAAM,OAAQ,OAAoB;AAClC,WAAO,SAAS,EAAE,GAAG,OAAO,QAAQ,MAAM,KAAK,KAAK,GAAG,EAAE;AAAA,EAC3D;AAEA,MAAI,WAA0B,MAAM,QAAQ,QAAQ,UAAU,EAAE,QAAQ,MAAM,eAAe,OAAO,MAAM,EAAE,CAAC;AAC7G,QAAM,OAAO,SAAS;AAEtB,SAAO,aAAa,sBAAsB,SAAS,MAAM;AACvD,UAAM,cAA6B,MAAM;AAAA,MACvC;AAAA,MACA;AAAA,MACA,MAAM,eAAe,EAAE,iBAAiB,KAAK,iBAAiB,CAAC;AAAA,IACjE;AACA,gBAAY,KAAK,QAAQ,EAAE,GAAG,SAAS,KAAK,OAAO,GAAG,YAAY,KAAK,MAAM;AAC7E,eAAW,EAAE,GAAG,YAAY;AAAA,EAC9B;AAEA,SAAO,SAAS;AAClB;","names":[]}